<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Future Tenses Test</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Source+Serif+4:ital,wght@0,300;0,400;1,300&display=swap" rel="stylesheet">
<!-- Add Axios for API calls -->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --ink: #1a1209;
    --paper: #f5f0e8;
    --aged: #e8e0cc;
    --accent: #8b2500;
    --gold: #c8922a;
    --light-ink: #5a4a35;
  }

  body {
    background: var(--paper);
    color: var(--ink);
    font-family: 'Source Serif 4', Georgia, serif;
    font-weight: 300;
    min-height: 100vh;
    padding: 0;
    background-image:
      repeating-linear-gradient(transparent, transparent 31px, #ddd4bb 31px, #ddd4bb 32px);
    background-size: 100% 32px;
  }

  header {
    background: var(--ink);
    color: var(--paper);
    padding: 40px 60px 30px;
    position: relative;
    overflow: hidden;
  }

  header::after {
    content: '';
    position: absolute;
    bottom: 0; left: 0; right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--accent), var(--gold), var(--accent));
  }

  .header-label {
    font-family: 'Source Serif 4', serif;
    font-size: 11px;
    letter-spacing: 4px;
    text-transform: uppercase;
    color: var(--gold);
    margin-bottom: 10px;
  }

  h1 {
    font-family: 'Playfair Display', serif;
    font-size: clamp(28px, 5vw, 52px);
    line-height: 1.1;
    margin-bottom: 8px;
  }

  .subtitle {
    font-style: italic;
    font-size: 15px;
    color: #aaa;
    margin-top: 6px;
  }

  .container {
    max-width: 860px;
    margin: 0 auto;
    padding: 40px 40px 80px;
  }

  .score-bar {
    background: var(--ink);
    color: var(--paper);
    border-radius: 4px;
    padding: 16px 24px;
    margin-bottom: 36px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-family: 'Playfair Display', serif;
    font-size: 18px;
  }

  .score-num {
    color: var(--gold);
    font-size: 26px;
  }

  .question-card {
    background: white;
    border: 1px solid var(--aged);
    border-left: 4px solid transparent;
    border-radius: 2px;
    padding: 20px 24px;
    margin-bottom: 16px;
    position: relative;
    transition: border-color 0.2s, box-shadow 0.2s;
    box-shadow: 0 1px 3px rgba(0,0,0,0.06);
  }

  .question-card:hover {
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  }

  .question-card.correct  { border-left-color: #2a6b4a; background: #f0faf5; }
  .question-card.wrong    { border-left-color: #8b2500; background: #fff5f3; }

  .q-header {
    display: flex;
    align-items: baseline;
    gap: 12px;
    margin-bottom: 12px;
  }

  .q-num {
    font-family: 'Playfair Display', serif;
    font-size: 22px;
    color: var(--gold);
    min-width: 32px;
  }

  .q-text {
    font-size: 15px;
    line-height: 1.6;
    flex: 1;
  }

  .blank {
    display: inline-block;
    border-bottom: 2px solid var(--ink);
    min-width: 120px;
    text-align: center;
    font-style: italic;
    color: var(--light-ink);
    vertical-align: bottom;
    margin: 0 4px;
    padding: 0 6px;
  }

  .options {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin-top: 12px;
  }

  .option-btn {
    background: var(--paper);
    border: 1px solid var(--aged);
    border-radius: 3px;
    padding: 9px 14px;
    font-family: 'Source Serif 4', serif;
    font-size: 13.5px;
    cursor: pointer;
    text-align: left;
    transition: all 0.15s;
    color: var(--ink);
    line-height: 1.3;
  }

  .option-btn:hover:not(:disabled) {
    background: var(--aged);
    border-color: var(--gold);
  }

  .option-btn.selected-correct {
    background: #d4edda;
    border-color: #2a6b4a;
    color: #1a4a2a;
    font-weight: 600;
  }

  .option-btn.selected-wrong {
    background: #fde8e4;
    border-color: #8b2500;
    color: #5a0000;
  }

  .option-btn.reveal-correct {
    background: #d4edda;
    border-color: #2a6b4a;
    color: #1a4a2a;
  }

  .option-btn:disabled {
    cursor: default;
  }

  .feedback {
    font-size: 13px;
    font-style: italic;
    margin-top: 10px;
    padding: 8px 12px;
    border-radius: 3px;
    display: none;
  }

  .feedback.show { display: block; }
  .feedback.correct { background: #d4edda; color: #1a4a2a; }
  .feedback.wrong   { background: #fde8e4; color: #5a0000; }

  .btn-check {
    background: var(--accent);
    color: white;
    border: none;
    padding: 14px 40px;
    font-family: 'Playfair Display', serif;
    font-size: 16px;
    cursor: pointer;
    border-radius: 3px;
    display: block;
    margin: 40px auto 0;
    letter-spacing: 1px;
    transition: background 0.2s;
  }

  .btn-check:hover { background: #6b1c00; }

  .btn-reset {
    background: transparent;
    color: var(--light-ink);
    border: 1px solid var(--aged);
    padding: 10px 30px;
    font-family: 'Source Serif 4', serif;
    font-size: 14px;
    cursor: pointer;
    border-radius: 3px;
    display: block;
    margin: 12px auto 0;
    transition: all 0.2s;
  }

  .btn-reset:hover { background: var(--aged); }

  .result-modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(26,18,9,0.85);
    z-index: 100;
    align-items: center;
    justify-content: center;
  }

  .result-modal.show { display: flex; }

  .modal-box {
    background: var(--paper);
    max-width: 420px;
    width: 90%;
    padding: 50px 40px;
    text-align: center;
    border-top: 6px solid var(--gold);
    border-radius: 2px;
  }

  .modal-score {
    font-family: 'Playfair Display', serif;
    font-size: 72px;
    color: var(--accent);
    line-height: 1;
  }

  .modal-total {
    font-size: 20px;
    color: var(--light-ink);
    margin-bottom: 20px;
  }

  .modal-message {
    font-style: italic;
    font-size: 16px;
    color: var(--light-ink);
    margin-bottom: 30px;
    line-height: 1.6;
  }

  .section-divider {
    font-family: 'Playfair Display', serif;
    font-size: 13px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--light-ink);
    text-align: center;
    margin: 30px 0 20px;
    display: flex;
    align-items: center;
    gap: 16px;
  }

  .section-divider::before, .section-divider::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--aged);
  }

  /* Loading spinner */
  .spinner {
    border: 3px solid var(--aged);
    border-top: 3px solid var(--accent);
    border-radius: 50%;
    width: 30px;
    height: 30px;
    animation: spin 1s linear infinite;
    margin: 0 auto;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  .loading-overlay {
    position: fixed;
    inset: 0;
    background: rgba(26,18,9,0.85);
    z-index: 200;
    display: none;
    align-items: center;
    justify-content: center;
  }

  .loading-overlay.show {
    display: flex;
  }

  .loading-box {
    background: var(--paper);
    padding: 30px;
    border-radius: 2px;
    text-align: center;
  }
</style>
</head>
<body>

<header>
  <div class="header-label">Grammar Practice Series</div>
  <h1>Future Tenses Test</h1>
  <div class="subtitle">40 mixed questions ‚Äî present continuous ¬∑ going to ¬∑ will ¬∑ present simple</div>
</header>

<div class="container">
  <div class="score-bar">
    <span>Your Score</span>
    <span class="score-num" id="live-score">0 / 40</span>
  </div>

  <div id="questions"></div>

  <button class="btn-check" onclick="checkAll()">Submit All Answers</button>
  <button class="btn-reset" onclick="resetAll()">Reset Test</button>
</div>

<!-- Results Modal -->
<div class="result-modal" id="modal">
  <div class="modal-box">
    <div class="modal-score" id="final-score">0</div>
    <div class="modal-total">out of 40</div>
    <div class="modal-message" id="modal-msg"></div>
    <button class="btn-check" onclick="document.getElementById('modal').classList.remove('show')">Review Answers</button>
    <button class="btn-reset" onclick="resetAll()">Try Again</button>
  </div>
</div>

<!-- User Info Modal -->
<div class="result-modal" id="user-info-modal">
  <div class="modal-box" style="max-width: 500px;">
    <h2 style="font-family: 'Playfair Display', serif; margin-bottom: 20px;">üìù Enter Your Details</h2>
    <p style="margin-bottom: 20px; color: var(--light-ink);">Please provide your information to submit your results.</p>
    
    <div style="text-align: left; margin-bottom: 20px;">
      <label style="display: block; margin-bottom: 10px; font-weight: 600;">Your Name:</label>
      <input type="text" id="user-name" placeholder="Enter your full name" 
             style="width: 100%; padding: 10px; border: 1px solid var(--aged); border-radius: 3px; margin-bottom: 20px;">
      
      <label style="display: block; margin-bottom: 10px; font-weight: 600;">Your Email:</label>
      <input type="email" id="user-email" placeholder="Enter your email address" 
             style="width: 100%; padding: 10px; border: 1px solid var(--aged); border-radius: 3px;">
    </div>
    
    <div style="display: flex; gap: 10px; justify-content: center;">
      <button class="btn-check" onclick="submitResults()" style="margin: 0;">Submit Results</button>
      <button class="btn-reset" onclick="closeUserInfoModal()" style="margin: 0;">Cancel</button>
    </div>
  </div>
</div>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loading-overlay">
  <div class="loading-box">
    <div class="spinner"></div>
    <p style="margin-top: 20px; font-style: italic;">Sending results to teacher...</p>
  </div>
</div>

<script>
const questions = [
  // Mixed order ‚Äî 10 PC, 10 GT, 10 WL, 10 PS shuffled
  {
    type: "WL",
    text: "Don't worry ‚Äî I ___ help you carry those bags.",
    options: ["am helping", "am going to help", "will help", "help"],
    answer: 2,
    explanation: "We use 'will' for spontaneous decisions made at the moment of speaking."
  },
  {
    type: "GT",
    text: "Look at those black clouds! It ___ rain.",
    options: ["will", "is going to", "rains", "is raining"],
    answer: 1,
    explanation: "'Going to' expresses a prediction based on present evidence (the clouds)."
  },
  {
    type: "PC",
    text: "We ___ our friends for dinner on Saturday. It's all arranged.",
    options: ["are meeting", "will meet", "are going to meet", "meet"],
    answer: 0,
    explanation: "Present continuous is used for fixed, arranged future plans."
  },
  {
    type: "PS",
    text: "The train ___ at 7:15 every morning.",
    options: ["is leaving", "will leave", "is going to leave", "leaves"],
    answer: 3,
    explanation: "Present simple is used for timetabled/scheduled events."
  },
  {
    type: "GT",
    text: "She has already bought the paint. She ___ redecorate her bedroom.",
    options: ["will", "is going to", "is", "redecorates"],
    answer: 1,
    explanation: "'Going to' expresses a plan or intention already decided."
  },
  {
    type: "WL",
    text: "I think humans ___ live on Mars one day.",
    options: ["are living", "are going to live", "will live", "live"],
    answer: 2,
    explanation: "'Will' is used for predictions not based on present evidence."
  },
  {
    type: "PC",
    text: "I can't meet you tomorrow ‚Äî I ___ all day.",
    options: ["will work", "work", "am working", "am going to work"],
    answer: 2,
    explanation: "Present continuous describes a pre-arranged future activity."
  },
  {
    type: "PS",
    text: "The museum ___ at 9 a.m. and closes at 6 p.m.",
    options: ["is opening", "will open", "is going to open", "opens"],
    answer: 3,
    explanation: "Timetable fact ‚Äî present simple."
  },
  {
    type: "WL",
    text: "A: We've run out of milk. B: Don't worry, I ___ get some.",
    options: ["am getting", "am going to get", "will get", "get"],
    answer: 2,
    explanation: "Spontaneous offer ‚Üí 'will'."
  },
  {
    type: "GT",
    text: "They've decided ‚Äî they ___ move to Canada next year.",
    options: ["will", "move", "are going to", "are moving"],
    answer: 2,
    explanation: "'Going to' for a decided intention."
  },
  {
    type: "PC",
    text: "He ___ a flight to Tokyo next Monday ‚Äî he booked it weeks ago.",
    options: ["takes", "will take", "is going to take", "is taking"],
    answer: 3,
    explanation: "Present continuous for arranged travel plans."
  },
  {
    type: "PS",
    text: "The ferry ___ twice a day in summer.",
    options: ["is running", "will run", "runs", "is going to run"],
    answer: 2,
    explanation: "Regular timetabled service ‚Üí present simple."
  },
  {
    type: "WL",
    text: "In my opinion, robots ___ replace most factory workers within 20 years.",
    options: ["are replacing", "replace", "are going to replace", "will replace"],
    answer: 3,
    explanation: "'Will' for personal future prediction."
  },
  {
    type: "PC",
    text: "We ___ the Louvre next Thursday. We've already got tickets.",
    options: ["visit", "are visiting", "will visit", "are going to visit"],
    answer: 1,
    explanation: "Arranged plan with tickets ‚Üí present continuous."
  },
  {
    type: "GT",
    text: "Be careful! That ladder is wobbling ‚Äî you ___ fall!",
    options: ["will", "are going to", "are", "fall"],
    answer: 1,
    explanation: "Evidence-based prediction ‚Üí 'going to'."
  },
  {
    type: "PS",
    text: "The next bus ___ at 10:30.",
    options: ["is going to arrive", "will arrive", "arrives", "is arriving"],
    answer: 2,
    explanation: "Fixed schedule ‚Üí present simple."
  },
  {
    type: "WL",
    text: "A: There's someone at the door. B: I ___ get it!",
    options: ["am going to get", "am getting", "get", "will get"],
    answer: 3,
    explanation: "Spontaneous decision ‚Üí 'will'."
  },
  {
    type: "GT",
    text: "I feel terrible. I think I ___ be sick.",
    options: ["will", "am", "am going to", "am being"],
    answer: 2,
    explanation: "Physical evidence of what is about to happen ‚Üí 'going to'."
  },
  {
    type: "PC",
    text: "She ___ at the Royal Theatre next Friday. It's on the poster.",
    options: ["will perform", "performs", "is going to perform", "is performing"],
    answer: 3,
    explanation: "Officially arranged future event ‚Üí present continuous."
  },
  {
    type: "PS",
    text: "The seminar ___ on the 3rd and ___ on the 5th.",
    options: ["starts / ends", "is starting / ending", "will start / end", "is going to start / end"],
    answer: 0,
    explanation: "Scheduled academic timetable ‚Üí present simple."
  },
  {
    type: "GT",
    text: "We've saved enough money. We ___ buy a house this year.",
    options: ["will", "are buying", "are going to", "buy"],
    answer: 2,
    explanation: "A decided intention ‚Üí 'going to'."
  },
  {
    type: "WL",
    text: "I promise I ___ call you as soon as I arrive.",
    options: ["am calling", "am going to call", "call", "will call"],
    answer: 3,
    explanation: "Promise in the future ‚Üí 'will'."
  },
  {
    type: "PC",
    text: "They ___ their new office on Monday ‚Äî everything is confirmed.",
    options: ["open", "will open", "are going to open", "are opening"],
    answer: 3,
    explanation: "Confirmed arrangement ‚Üí present continuous."
  },
  {
    type: "PS",
    text: "The conference ___ on Tuesday and ___ on Thursday.",
    options: ["begins / finishes", "is beginning / finishing", "will begin / finish", "is going to begin / finish"],
    answer: 0,
    explanation: "Official programme timetable ‚Üí present simple."
  },
  {
    type: "WL",
    text: "I'm sure you ___ love the film. It's amazing!",
    options: ["are going to", "are loving", "love", "will"],
    answer: 3,
    explanation: "Prediction/assumption ‚Üí 'will'."
  },
  {
    type: "GT",
    text: "He's practising every day. He ___ enter the marathon.",
    options: ["will", "enters", "is entering", "is going to"],
    answer: 3,
    explanation: "Clear intention supported by present behaviour ‚Üí 'going to'."
  },
  {
    type: "PC",
    text: "I ___ lunch with my manager at noon ‚Äî it's in the calendar.",
    options: ["will have", "have", "am going to have", "am having"],
    answer: 3,
    explanation: "Diary arrangement ‚Üí present continuous."
  },
  {
    type: "PS",
    text: "School ___ at 8:30 and ___ at 15:00.",
    options: ["starts / ends", "is starting / ending", "will start / end", "goes to start / end"],
    answer: 0,
    explanation: "Daily timetable ‚Üí present simple."
  },
  {
    type: "GT",
    text: "Look ‚Äî she's running fast. She ___ win the race!",
    options: ["will win", "wins", "is going to win", "is winning"],
    answer: 2,
    explanation: "Visual evidence of likely outcome ‚Üí 'going to'."
  },
  {
    type: "WL",
    text: "Maybe the weather ___ improve tomorrow.",
    options: ["is going to", "improves", "is improving", "will"],
    answer: 3,
    explanation: "'Will' for uncertain future prediction with 'maybe'."
  },
  {
    type: "PC",
    text: "We ___ a new member of staff on Wednesday. She starts Thursday.",
    options: ["will interview", "interview", "are going to interview", "are interviewing"],
    answer: 3,
    explanation: "Organised upcoming event ‚Üí present continuous."
  },
  {
    type: "PS",
    text: "The pharmacy ___ on Sundays.",
    options: ["isn't opening", "won't open", "doesn't open", "isn't going to open"],
    answer: 2,
    explanation: "Fixed business hours ‚Üí present simple."
  },
  {
    type: "WL",
    text: "She ___ probably be late ‚Äî the traffic is always bad on Fridays.",
    options: ["is going to", "is", "will", "will be going to"],
    answer: 2,
    explanation: "'Probably will' for prediction."
  },
  {
    type: "GT",
    text: "They've already signed the contract ‚Äî they ___ merge the two companies.",
    options: ["will", "are merging", "are going to", "merge"],
    answer: 2,
    explanation: "Firm decided plan ‚Üí 'going to'."
  },
  {
    type: "PC",
    text: "The band ___ at the stadium on New Year's Eve. The tickets sold out last month.",
    options: ["plays", "will play", "is going to play", "is playing"],
    answer: 3,
    explanation: "Officially scheduled performance ‚Üí present continuous."
  },
  {
    type: "PS",
    text: "The 9 o'clock train ___ at Oxford, Cambridge, and London.",
    options: ["is stopping", "will stop", "stops", "is going to stop"],
    answer: 2,
    explanation: "Train timetable ‚Üí present simple."
  },
  {
    type: "WL",
    text: "If it rains, we ___ cancel the picnic.",
    options: ["are cancelling", "are going to cancel", "cancel", "will cancel"],
    answer: 3,
    explanation: "'Will' in conditional future sentences."
  },
  {
    type: "GT",
    text: "She's saved her CV and clicked send. She ___ apply for the job.",
    options: ["will apply", "applies", "is going to apply", "is applying"],
    answer: 2,
    explanation: "Evident immediate intention ‚Üí 'going to'."
  },
  {
    type: "PC",
    text: "I ___ a dentist appointment next Tuesday afternoon.",
    options: ["will have", "have", "am going to have", "am having"],
    answer: 3,
    explanation: "Booked appointment ‚Üí present continuous."
  },
  {
    type: "PS",
    text: "The flight from Paris ___ at gate 7 at 06:45.",
    options: ["is boarding", "will board", "boards", "is going to board"],
    answer: 2,
    explanation: "Flight schedule ‚Üí present simple."
  }
];

let answered = {};
let currentResults = null;

function renderQuestions() {
  const container = document.getElementById('questions');
  container.innerHTML = '';

  questions.forEach((q, i) => {
    const card = document.createElement('div');
    card.className = 'question-card';
    card.id = `card-${i}`;

    const optionsHTML = q.options.map((opt, j) =>
      `<button class="option-btn" onclick="selectOption(${i}, ${j})" id="opt-${i}-${j}">${opt}</button>`
    ).join('');

    card.innerHTML = `
      <div class="q-header">
        <div class="q-num">${i + 1}</div>
      </div>
      <div class="q-text">${q.text.replace('___', '<span class="blank">___</span>')}</div>
      <div class="options">${optionsHTML}</div>
      <div class="feedback" id="fb-${i}"></div>
    `;
    container.appendChild(card);
  });

  updateScore();
}

function selectOption(qIdx, optIdx) {
  if (answered[qIdx] !== undefined) return;
  answered[qIdx] = optIdx;

  const q = questions[qIdx];
  const correct = q.answer;

  for (let j = 0; j < q.options.length; j++) {
    const btn = document.getElementById(`opt-${qIdx}-${j}`);
    btn.disabled = true;
    if (j === correct) btn.classList.add('reveal-correct');
    else if (j === optIdx && optIdx !== correct) btn.classList.add('selected-wrong');
  }

  if (optIdx === correct) {
    document.getElementById(`opt-${qIdx}-${optIdx}`).className = 'option-btn selected-correct';
  }

  const fb = document.getElementById(`fb-${qIdx}`);
  const card = document.getElementById(`card-${qIdx}`);

  if (optIdx === correct) {
    fb.textContent = '‚úì Correct! ' + q.explanation;
    fb.className = 'feedback show correct';
    card.classList.add('correct');
  } else {
    fb.textContent = `‚úó The correct answer is "${q.options[correct]}". ${q.explanation}`;
    fb.className = 'feedback show wrong';
    card.classList.add('wrong');
  }

  updateScore();
}

function updateScore() {
  const total = Object.keys(answered).length;
  const correct = Object.values(answered).filter((v, i) => v === questions[i].answer).length;
  document.getElementById('live-score').textContent = `${correct} / ${total} answered`;
}

function checkAll() {
  // Answer any unanswered questions (mark as skipped)
  let allAnswered = true;
  questions.forEach((q, i) => {
    if (answered[i] === undefined) {
      allAnswered = false;
      const card = document.getElementById(`card-${i}`);
      card.style.borderLeftColor = '#c8922a';
      card.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }
  });

  if (!allAnswered) {
    alert('Please answer all questions before submitting!');
    return;
  }

  // Calculate results
  const correct = Object.values(answered).filter((v, i) => v === questions[i].answer).length;
  const percentage = Math.round((correct / 40) * 100);
  
  // Prepare results data
  currentResults = {
    score: correct,
    total: 40,
    percentage: percentage,
    timestamp: new Date().toISOString(),
    results: questions.map((q, i) => ({
      type: q.type,
      questionText: q.text,
      selected: q.options[answered[i]],
      correct: q.options[q.answer],
      isCorrect: answered[i] === q.answer,
      explanation: q.explanation
    }))
  };

  // Show user info modal instead of results modal
  document.getElementById('user-info-modal').classList.add('show');
}

function closeUserInfoModal() {
  document.getElementById('user-info-modal').classList.remove('show');
  document.getElementById('user-name').value = '';
  document.getElementById('user-email').value = '';
}

async function submitResults() {
  const name = document.getElementById('user-name').value.trim();
  const email = document.getElementById('user-email').value.trim();

  if (!name || !email) {
    alert('Please enter both name and email');
    return;
  }

  if (!isValidEmail(email)) {
    alert('Please enter a valid email address');
    return;
  }

  // Close user info modal
  closeUserInfoModal();

  // Show loading overlay
  document.getElementById('loading-overlay').classList.add('show');

  try {
    // Send data to Telegram API
    const response = await axios.post('/api/telegram', {
      name: name,
      email: email,
      score: currentResults.score,
      total: currentResults.total,
      percentage: currentResults.percentage,
      results: currentResults.results,
      timestamp: currentResults.timestamp
    });

    if (response.data.success) {
      // Hide loading overlay
      document.getElementById('loading-overlay').classList.remove('show');
      
      // Show success message
      alert('‚úÖ Results sent successfully to your teacher!');
      
      // Show the regular results modal
      showResultsModal(currentResults.score);
    } else {
      throw new Error('Failed to send results');
    }
  } catch (error) {
    console.error('Error sending results:', error);
    
    // Hide loading overlay
    document.getElementById('loading-overlay').classList.remove('show');
    
    // Show error message but still allow viewing results
    alert('‚ö†Ô∏è Results saved locally but failed to send to teacher. Please try again or contact support.');
    
    // Show the regular results modal anyway
    showResultsModal(currentResults.score);
  }
}

function isValidEmail(email) {
  const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return re.test(email);
}

function showResultsModal(score) {
  document.getElementById('final-score').textContent = score;

  let msg = '';
  if (score === 40) msg = 'Perfect score! Outstanding mastery of future tenses!';
  else if (score >= 35) msg = 'Excellent! You have a strong command of future tenses.';
  else if (score >= 28) msg = 'Good job! A solid understanding with room to improve.';
  else if (score >= 20) msg = 'Fair attempt. Review the tense rules and try again.';
  else msg = 'Keep practising! Study each tense carefully and try again.';

  document.getElementById('modal-msg').textContent = msg;
  document.getElementById('modal').classList.add('show');
}

function resetAll() {
  answered = {};
  currentResults = null;
  document.getElementById('modal').classList.remove('show');
  document.getElementById('user-info-modal').classList.remove('show');
  document.getElementById('loading-overlay').classList.remove('show');
  document.getElementById('user-name').value = '';
  document.getElementById('user-email').value = '';
  renderQuestions();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

renderQuestions();
</script>
</body>
</html>
